#!/usr/bin/env bash

# Install node packages
npm install

# Install Buildkite Test Engine Client
# See https://buildkite.com/docs/test-engine/test-splitting/client-installation
curl -L https://github.com/buildkite/test-engine-client/releases/download/v1.1.0-rc.1/bktec_1.1.0-rc.1_linux_amd64 -o ./bktec
chmod +x ./bktec

# Configure Buildkite Test Engine Client
# See https://buildkite.com/docs/test-engine/test-splitting/configuring
export BUILDKITE_TEST_ENGINE_DEBUG_ENABLED=true
export BUILDKITE_TEST_ENGINE_RESULT_PATH=tmp/playwright.json
export BUILDKITE_TEST_ENGINE_RETRY_COUNT=1
export BUILDKITE_TEST_ENGINE_TEST_RUNNER=playwright

# Run Buildkite Test Engine Client
./bktec
