#!/usr/bin/env bash

# Install node packages
npm install

# Install Buildkite Test Engine Client
# See https://buildkite.com/docs/test-engine/test-splitting/client-installation
curl -L https://github.com/buildkite/test-engine-client/releases/download/v1.2.0-rc.3/bktec_1.2.0-rc.3_linux_amd64 -o ./bktec
chmod +x ./bktec

# Configure Buildkite Test Engine Client
# See https://buildkite.com/docs/test-engine/test-splitting/configuring
export BUILDKITE_TEST_ENGINE_TEST_RUNNER=playwright
export BUILDKITE_TEST_ENGINE_RESULT_PATH=tmp/playwright-results.json
export BUILDKITE_TEST_ENGINE_TEST_FILE_PATTERN="**/demo-todo-app/*.spec.js"

# Run Buildkite Test Engine Client
./bktec
